<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>Game 100 Box (FIXED)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
/* === CSS ASLI (TIDAK DIUBAH) === */
:root{
  --bg1:#1b1b1b;--bg2:#000;--panel:#111;--line:#444;
  --gold:#ffd700;--silver:#cfcfcf;--bronze:#cd7f32;
  --cell:44px;--gap:5px;
}
*{box-sizing:border-box}
body{
  margin:0;min-height:100vh;
  background:radial-gradient(circle,var(--bg1),var(--bg2));
  color:#fff;font-family:Arial,sans-serif
}
.app{display:flex;gap:28px;padding:18px}
.game{width:520px}
.topbar{display:flex;gap:12px}

/* grid */
#grid{
  margin-top:10px;
  display:grid;
  grid-template-columns:repeat(10,var(--cell));
  gap:var(--gap);
}
.card{
  width:var(--cell);height:var(--cell);
  position:relative;
  transform-style:preserve-3d;
  transition:.5s;
  cursor:pointer
}
.card.flipped{transform:rotateY(180deg)}
.face{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  border:1px solid #666;
  backface-visibility:hidden;
  font-size:12px
}
.front{background:#444}
.back{background:#000;transform:rotateY(180deg)}
.back img{width:100%;height:100%;object-fit:contain}
</style>
</head>

<body>
<div class="app">
  <section class="game">
    <input id="userId" placeholder="USER ID">
    <button id="reset">RESET</button>
    <div id="grid"></div>
  </section>
</div>

<script>
/* === CONFIG === */
const TOTAL={P1:1,P2:1,P3:1,P4:7,P5:10,P6:10,P7:20,P8:50};
const LABEL={P1:"PRIZE 1",P2:"PRIZE 2",P3:"PRIZE 3",P4:"PRIZE 4",P5:"PRIZE 5",P6:"PRIZE 6",P7:"PRIZE 7",P8:"PRIZE 8"};
const TOP3=new Set(["P1","P2","P3"]);
const KEYS=Object.keys(TOTAL);

let prizes=[], opened=[], adminArmed=null, adminUsed={P1:false,P2:false,P3:false};

const grid=document.getElementById("grid");

/* === GENERATE === */
function gen(){
  prizes=[];
  KEYS.forEach(p=>{for(let i=0;i<TOTAL[p];i++)prizes.push(p)});
  prizes.sort(()=>Math.random()-0.5);
  opened=Array(100).fill(false);
  adminArmed=null;
  adminUsed={P1:false,P2:false,P3:false};
}

/* === UTIL === */
function remainingUnopened(){
  return opened.filter(x=>!x).length;
}
function remainingNonTop3Index(){
  for(let i=0;i<100;i++){
    if(!opened[i] && !TOP3.has(prizes[i])) return i;
  }
  return -1;
}
function canNormalTop3(){
  return remainingUnopened()<=3;
}
function findPrize(p){
  for(let i=0;i<100;i++){
    if(!opened[i] && prizes[i]===p) return i;
  }
  return -1;
}

/* === OPEN CELL (FIXED) === */
function openCell(i,el){
  if(opened[i]) return;

  let p=prizes[i];

  /* ADMIN FORCE */
  if(adminArmed){
    const f=adminArmed; adminArmed=null;
    if(!adminUsed[f]){
      const j=findPrize(f);
      if(j!==-1){
        [prizes[i],prizes[j]]=[prizes[j],prizes[i]];
        adminUsed[f]=true;
        p=prizes[i];
      }
    }
  }
  /* NORMAL CLICK â€” TIDAK PERNAH BLOK */
  else if(TOP3.has(p) && !canNormalTop3()){
    const j=remainingNonTop3Index();
    if(j!==-1){
      [prizes[i],prizes[j]]=[prizes[j],prizes[i]];
      p=prizes[i];
    }
  }

  opened[i]=true;
  el.classList.add("flipped");
  el.querySelector(".back").innerHTML=LABEL[p];
}

/* === RENDER === */
function render(){
  grid.innerHTML="";
  for(let i=0;i<100;i++){
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<div class="face front">${i+1}</div><div class="face back"></div>`;
    c.onclick=()=>openCell(i,c);
    grid.appendChild(c);
  }
}

document.getElementById("reset").onclick=()=>{gen();render()};

/* HOTKEY */
document.addEventListener("keydown",e=>{
  if(e.key==="F1") adminArmed="P1";
  if(e.key==="F2") adminArmed="P2";
  if(e.key==="F3") adminArmed="P3";
});

gen(); render();
</script>
</body>
</html>
