<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>Game 100 Box</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg1:#1b1b1b;--bg2:#000;--panel:#111;--line:#444;
  --gold:#ffd700;--silver:#cfcfcf;--bronze:#cd7f32;
  --cell:44px;--gap:5px;
}
*{box-sizing:border-box}
body{
  margin:0;min-height:100vh;
  background:radial-gradient(circle,var(--bg1),var(--bg2));
  color:#fff;font-family:Arial,sans-serif;overflow-x:hidden
}
.app{display:flex;gap:28px;padding:18px}
.game{width:520px}
.topbar{display:flex;gap:12px;align-items:flex-start}

/* upload */
#uploadPanel{display:grid;grid-template-columns:repeat(4,32px);gap:6px}
.uBtn{width:32px;height:28px;background:#fff;color:#000;border:1px solid #bbb;cursor:pointer;border-radius:2px}

/* counter */
#counterPanel{
  display:grid;grid-template-columns:repeat(4,1fr);
  gap:6px;padding:8px;background:var(--panel);border:1px solid var(--line);
  min-width:260px
}
.counterItem{background:#000;border:1px solid #555;padding:4px;font-size:12px;text-align:center;white-space:nowrap}

/* grid */
#grid{
  margin-top:10px;display:grid;
  grid-template-columns:repeat(10,var(--cell));
  gap:var(--gap);perspective:1000px
}
.card{
  width:var(--cell);height:var(--cell);
  position:relative;transform-style:preserve-3d;
  transition:.55s;cursor:pointer;user-select:none
}
.card.flipped{transform:rotateY(180deg)}
.face{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  border:1px solid #666;backface-visibility:hidden;font-size:12px;overflow:hidden
}
.front{background:#3b3b3b}
.back{background:#000;transform:rotateY(180deg)}
.back img{width:100%;height:100%;object-fit:contain;background:#000}

/* controls */
.controls{display:flex;gap:8px;margin-top:14px}
input,select{padding:8px}
button{padding:8px 14px;cursor:pointer;border-radius:2px}

/* leaderboard */
.right{min-width:440px}
.tableWrap{max-height:320px;overflow-y:auto;overflow-x:hidden;border:1px solid #333}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border:1px solid #555;padding:6px;text-align:center}
th{background:#222;position:sticky;top:0}
.lb1{background:linear-gradient(90deg,#6b5200,var(--gold),#6b5200);color:#000;font-weight:bold}
.lb2{background:linear-gradient(90deg,#666,var(--silver),#666);color:#000;font-weight:bold}
.lb3{background:linear-gradient(90deg,#5a3a1a,var(--bronze),#5a3a1a);color:#000;font-weight:bold}

/* ===== TOP PRIZE + GLOW ===== */
.topPrizes{display:flex;gap:18px;margin-top:14px}
.tpItem{display:flex;flex-direction:column;align-items:center;gap:6px}
.tpBox{
  width:120px;height:100px;background:#000;border:2px solid;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;border-radius:4px
}
.tpBox img{width:100%;height:100%;object-fit:contain}

/* glowing animation */
@keyframes glowGold{
  0%{box-shadow:0 0 4px var(--gold)}
  50%{box-shadow:0 0 14px var(--gold)}
  100%{box-shadow:0 0 4px var(--gold)}
}
@keyframes glowSilver{
  0%{box-shadow:0 0 4px var(--silver)}
  50%{box-shadow:0 0 12px #eee}
  100%{box-shadow:0 0 4px var(--silver)}
}
@keyframes glowBronze{
  0%{box-shadow:0 0 4px var(--bronze)}
  50%{box-shadow:0 0 12px var(--bronze)}
  100%{box-shadow:0 0 4px var(--bronze)}
}

.gold{border-color:var(--gold);animation:glowGold 2s infinite}
.silver{border-color:var(--silver);animation:glowSilver 2s infinite}
.bronze{border-color:var(--bronze);animation:glowBronze 2s infinite}
</style>
</head>

<body>
<div class="app">

<section class="game">
  <div class="topbar">
    <div id="uploadPanel"></div>
    <div id="counterPanel"></div>
  </div>

  <div id="grid"></div>

  <div class="controls">
    <input id="userId" placeholder="User ID">
    <select id="pay">
      <option value="CASH">CASH</option>
      <option value="SECRET">SECRET</option>
    </select>
    <button id="reset">RESET</button>
    <button id="openAll">OPEN ALL</button>
  </div>
</section>

<section class="right">
  <div class="tableWrap">
    <table>
      <thead>
        <tr><th>üèÜ</th><th>USER ID</th><th>TOTAL</th><th>SPEND</th></tr>
      </thead>
      <tbody id="lb"></tbody>
    </table>
  </div>

  <div class="topPrizes">
    <div class="tpItem"><div id="tp1" class="tpBox gold"></div><div>PRIZE 1</div></div>
    <div class="tpItem"><div id="tp2" class="tpBox silver"></div><div>PRIZE 2</div></div>
    <div class="tpItem"><div id="tp3" class="tpBox bronze"></div><div>PRIZE 3</div></div>
  </div>
</section>

</div>

<script>
/* ===== CONFIG ===== */
const PRICE={CASH:2000,SECRET:1};
const TOTAL={P1:1,P2:1,P3:1,P4:7,P5:10,P6:10,P7:20,P8:50};
const LABEL={P1:"PRIZE 1",P2:"PRIZE 2",P3:"PRIZE 3",P4:"PRIZE 4",P5:"PRIZE 5",P6:"PRIZE 6",P7:"PRIZE 7",P8:"PRIZE 8"};
const TOP3=new Set(["P1","P2","P3"]);
const KEYS=Object.keys(TOTAL);

const LS_IMG="imgs_glow_final";
const LS_LB="lb_glow_final";

let prizes=[],opened=[];
let adminArmed=null;
let adminUsed={P1:false,P2:false,P3:false};
let images=JSON.parse(localStorage.getItem(LS_IMG)||"{}");
let lb=JSON.parse(localStorage.getItem(LS_LB)||"{}");

const grid=document.getElementById("grid");
const counter=document.getElementById("counterPanel");
const lbBody=document.getElementById("lb");

const uid=()=>document.getElementById("userId").value.trim().toUpperCase();
const paySel=()=>document.getElementById("pay").value;

function saveLB(){localStorage.setItem(LS_LB,JSON.stringify(lb))}
function saveIMG(){localStorage.setItem(LS_IMG,JSON.stringify(images))}

function gen(){
  prizes=[];
  KEYS.forEach(p=>{for(let i=0;i<TOTAL[p];i++)prizes.push(p)});
  for(let i=prizes.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [prizes[i],prizes[j]]=[prizes[j],prizes[i]];
  }
  opened=Array(100).fill(false);
  adminArmed=null;
  adminUsed={P1:false,P2:false,P3:false};
}

function backHTML(p){return images[p]?`<img src="${images[p]}">`:LABEL[p]}

function renderGrid(){
  grid.innerHTML="";
  for(let i=0;i<100;i++){
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`<div class="face front">${i+1}</div><div class="face back">${backHTML(prizes[i])}</div>`;
    d.onclick=()=>openCell(i,d,true);
    grid.appendChild(d);
  }
  renderCounter();
}

function renderCounter(){
  counter.innerHTML="";
  KEYS.forEach(p=>{
    const used=prizes.filter((x,i)=>x===p&&opened[i]).length;
    counter.innerHTML+=`<div class="counterItem">${LABEL[p]} : ${TOTAL[p]-used}</div>`;
  });
}

function renderLB(){
  lbBody.innerHTML="";
  Object.entries(lb).sort((a,b)=>b[1].open-a[1].open).forEach(([u,d],i)=>{
    const tr=document.createElement("tr");
    if(i<3) tr.className=["lb1","lb2","lb3"][i];
    tr.innerHTML=`<td>${i+1}</td><td>${u}</td><td>${d.open}</td><td>Rp.${(d.cash||0).toLocaleString()}/${d.secret||0} SECRET</td>`;
    lbBody.appendChild(tr);
  });
}

function renderTop(){
  ["P1","P2","P3"].forEach((p,i)=>{
    document.getElementById("tp"+(i+1)).innerHTML=images[p]?`<img src="${images[p]}">`:LABEL[p];
  });
}

function remainingUnopened(){return opened.filter(x=>!x).length}
function remainingNonTop3(){
  let c=0;for(let i=0;i<100;i++)if(!opened[i]&&!TOP3.has(prizes[i]))c++;return c;
}
function canNormalTop3(){return remainingUnopened()<=3||remainingNonTop3()===0}
function findUnopenedWithPrize(p){
  for(let i=0;i<100;i++)if(!opened[i]&&prizes[i]===p)return i;
  return -1;
}

function openCell(i,el,count){
  if(opened[i]){adminArmed=null;return}
  if(count && !uid()) return alert("ISI USER ID");

  let p=prizes[i];

  if(adminArmed){
    const f=adminArmed; adminArmed=null;
    if(!adminUsed[f]){
      const j=findUnopenedWithPrize(f);
      if(j!==-1){
        [prizes[i],prizes[j]]=[prizes[j],prizes[i]];
        p=prizes[i]; adminUsed[f]=true;
      }
    }
  }else{
    if(TOP3.has(p)&&!canNormalTop3()) return;
  }

  opened[i]=true;
  el.classList.add("flipped");
  el.querySelector(".back").innerHTML=backHTML(prizes[i]);

  if(count){
    lb[uid()]??={open:0,cash:0,secret:0};
    lb[uid()].open++;
    const m=paySel();
    lb[uid()][m.toLowerCase()]+=PRICE[m];
    saveLB(); renderLB();
  }
  renderCounter();
}

document.getElementById("openAll").onclick=()=>{
  adminArmed=null;
  document.querySelectorAll(".card").forEach((c,i)=>{
    if(!opened[i]){
      opened[i]=true;
      c.classList.add("flipped");
      c.querySelector(".back").innerHTML=backHTML(prizes[i]);
    }
  });
  renderCounter();
};

document.getElementById("reset").onclick=()=>{gen();renderGrid()};

document.addEventListener("keydown",e=>{
  if(["F1","F2","F3","F6"].includes(e.key)) e.preventDefault();
  if(e.key==="F1") adminArmed="P1";
  if(e.key==="F2") adminArmed="P2";
  if(e.key==="F3") adminArmed="P3";
  if(e.key==="F6" && confirm("Reset leaderboard?")){
    lb={}; saveLB(); renderLB();
  }
});

function initUpload(){
  const up=document.getElementById("uploadPanel");
  KEYS.forEach((p,i)=>{
    const inp=document.createElement("input");
    inp.type="file"; inp.accept="image/*"; inp.hidden=true;
    inp.onchange=e=>{
      const f=e.target.files[0]; if(!f) return;
      const r=new FileReader();
      r.onload=()=>{
        images[p]=r.result; saveIMG();
        document.querySelectorAll(".card").forEach((c,idx)=>{
          if(prizes[idx]===p) c.querySelector(".back").innerHTML=backHTML(p);
        });
        renderTop();
      };
      r.readAsDataURL(f); inp.value="";
    };
    const b=document.createElement("button");
    b.className="uBtn"; b.textContent=i+1; b.onclick=()=>inp.click();
    up.append(b,inp);
  });
}

function init(){
  initUpload();
  gen();
  renderGrid();
  renderLB();
  renderTop();
}
init();
</script>
</body>
</html>
